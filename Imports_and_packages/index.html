<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Imports and packages - My Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Welcome to MkDocs</a>
                            </li>
                            <li class="navitem">
                                <a href="../Buildmeister_process/" class="nav-link">Buildmeister process</a>
                            </li>
                            <li class="navitem">
                                <a href="../Code_review/" class="nav-link">Code review</a>
                            </li>
                            <li class="navitem">
                                <a href="../Codebase_clean_up_scripts/" class="nav-link">Codebase clean-up scripts</a>
                            </li>
                            <li class="navitem">
                                <a href="../Coding_Style_Guide/" class="nav-link">Sorrentum - Python Style Guide</a>
                            </li>
                            <li class="navitem">
                                <a href="../Contributor_Scorecard/" class="nav-link">Contributor Scorecard</a>
                            </li>
                            <li class="navitem">
                                <a href="../DataFlow/" class="nav-link">DataFlow specification</a>
                            </li>
                            <li class="navitem">
                                <a href="../DataPull/" class="nav-link">DataPull</a>
                            </li>
                            <li class="navitem">
                                <a href="../Design_Philosophy/" class="nav-link">Design Philosophy</a>
                            </li>
                            <li class="navitem">
                                <a href="../Development_workflow/" class="nav-link">Development Workflow</a>
                            </li>
                            <li class="navitem">
                                <a href="../Docker/" class="nav-link">Docker</a>
                            </li>
                            <li class="navitem">
                                <a href="../Documentation_about_guidelines/" class="nav-link">Documentation about guidelines</a>
                            </li>
                            <li class="navitem">
                                <a href="../Email/" class="nav-link">Email</a>
                            </li>
                            <li class="navitem">
                                <a href="../First_review_process/" class="nav-link">First Review Process</a>
                            </li>
                            <li class="navitem">
                                <a href="../From_zero_to_modeling/" class="nav-link">From zero to modeling</a>
                            </li>
                            <li class="navitem">
                                <a href="../General_rules_of_collaboration/" class="nav-link">General Rules of Collaboration</a>
                            </li>
                            <li class="navitem">
                                <a href="../GitHub_ZenHub_workflows/" class="nav-link">GitHub/ZenHub workflows</a>
                            </li>
                            <li class="navitem">
                                <a href="../Git_workflow_and_best_practices/" class="nav-link">Git workflow and best practices</a>
                            </li>
                            <li class="navitem">
                                <a href="../Glossary/" class="nav-link">Glossary</a>
                            </li>
                            <li class="navitem">
                                <a href="../Gsheet_into_pandas/" class="nav-link">Gsheet into pandas</a>
                            </li>
                            <li class="navitem">
                                <a href="../HTMLcov_server/" class="nav-link">HTMLcov server</a>
                            </li>
                            <li class="navitem">
                                <a href="../How_to_integrate_repos/" class="nav-link">How to integrate repos</a>
                            </li>
                            <li class="navitem">
                                <a href="../How_to_organize_your_work/" class="nav-link">Golden rules</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Imports and packages</a>
                            </li>
                            <li class="navitem">
                                <a href="../Jupyter_notebook_best_practices/" class="nav-link">Jupyter notebook best practices</a>
                            </li>
                            <li class="navitem">
                                <a href="../Reading_List/" class="nav-link">Reading List</a>
                            </li>
                            <li class="navitem">
                                <a href="../Receive_crypto_payment/" class="nav-link">Receive crypto payment</a>
                            </li>
                            <li class="navitem">
                                <a href="../Scrum_methodology/" class="nav-link">Scrum Methodology</a>
                            </li>
                            <li class="navitem">
                                <a href="../Signing_up_for_Sorrentum/" class="nav-link">Signing up to the project</a>
                            </li>
                            <li class="navitem">
                                <a href="../Sorrentum_development_setup/" class="nav-link">Sorrentum development setup</a>
                            </li>
                            <li class="navitem">
                                <a href="../Telegram/" class="nav-link">Telegram</a>
                            </li>
                            <li class="navitem">
                                <a href="../Tools-PyCharm/" class="nav-link">Running PyCharm remotely</a>
                            </li>
                            <li class="navitem">
                                <a href="../Type_hints/" class="nav-link">Type hints</a>
                            </li>
                            <li class="navitem">
                                <a href="../Unit_tests/" class="nav-link">Unit tests</a>
                            </li>
                            <li class="navitem">
                                <a href="../Visual_Studio_Code/" class="nav-link">Visual Studio Code</a>
                            </li>
                            <li class="navitem">
                                <a href="../Workflows/" class="nav-link">Navigate stack of failed test</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../How_to_organize_your_work/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../Jupyter_notebook_best_practices/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#imports-and-packages" class="nav-link">Imports and packages</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#goals-of-packages" class="nav-link">Goals of packages</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#circular-dependency-aka-import-cycle-import-loop" class="nav-link">Circular dependency (aka import cycle, import loop)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#rules-for-imports" class="nav-link">Rules for imports</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#how-to-import-code-from-unit-tests" class="nav-link">How to import code from unit tests</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#packagelib-hierarchy-and-cycle-prevention" class="nav-link">Package/lib hierarchy and cycle prevention</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#anatomy-of-a-package" class="nav-link">Anatomy of a package</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="imports-and-packages">Imports and packages</h1>
<!-- toc -->

<ul>
<li><a href="#goals-of-packages">Goals of packages</a></li>
<li><a href="#circular-dependency-aka-import-cycle-import-loop">Circular dependency (aka import cycle, import loop)</a></li>
<li><a href="#rules-for-imports">Rules for imports</a></li>
<li><a href="#how-to-import-code-from-unit-tests">How to import code from unit tests</a><ul>
<li><a href="#common-unit-test-code">Common unit test code</a></li>
</ul>
</li>
<li><a href="#packagelib-hierarchy-and-cycle-prevention">Package/lib hierarchy and cycle prevention</a></li>
<li><a href="#anatomy-of-a-package">Anatomy of a package</a></li>
</ul>
<!-- tocstop -->

<ul>
<li>TODO(gp): Consolidate here any other rule from other gdoc</li>
</ul>
<h1 id="goals-of-packages">Goals of packages</h1>
<ul>
<li>
<p>The goal of creating packages is to:</p>
</li>
<li>
<p>Simplify the import from clients</p>
</li>
<li>Hide in which file the actual code is, so that we can reorganize the code
    without having to change all the client code</li>
<li>Organize the code in related units</li>
<li>
<p>Make it simpler to avoid import loops by enforcing that there are no import
    loops in any module and no import loops among modules</p>
</li>
<li>
<p>E.g., referring to package from a different package looks like
  <code>python
  import dataflow.core as dtfcore
  dtfcore.ArmaGenerator(...)</code></p>
</li>
<li>Importing the specific file:
  <code>python
  import dataflow.system.source_nodes as dtfsysonod
  dtfsysonod.ArmaGenerator(...)</code></li>
</ul>
<h2 id="circular-dependency-aka-import-cycle-import-loop">Circular dependency (aka import cycle, import loop)</h2>
<ul>
<li>The simplest case of circular import is a situation when in lib <code>A</code> we have
  <code>import B</code>, and in lib B we have <code>import A</code></li>
<li>The presence of circular imports can be checked with an invoke <code>i
  lint_detect_cycles</code>. By default, it will run on the whole repo, which takes a
  couple of minutes, but it will provide the most reliable and thorough check
  for circular imports</li>
</ul>
<h2 id="rules-for-imports">Rules for imports</h2>
<ul>
<li>
<p>We follow rules to avoid import loops:</p>
</li>
<li>
<p>Code inside a package should import directly a file in the same package and
    not use the package</p>
<ul>
<li>
<p>E.g., <code>im_v2/common/data/client/data_frame_im_clients.py</code></p>
</li>
<li>
<p>Good</p>
<p><code>python
import im_v2.common.data.client.base_im_clients as imvcdcbimcl</code></p>
</li>
<li>
<p>Bad
    <code>python
    import im_v2.common.data.client as icdc</code></p>
</li>
</ul>
</li>
<li>
<p>Code from a package should import other packages, instead of importing
    directly the file</p>
</li>
<li>We don't allow any import loop that can be detected statically (i.e., by
    inspecting the code without executing it)<ul>
<li>This guarantees that there are no dynamic import loops, which are even
  more difficult to detect and disruptive</li>
</ul>
</li>
<li>We allow only imports at the module level and not inside functions<ul>
<li>We don't accept using local imports to break import loops, unless it's
  temporary to solve a more important problem</li>
</ul>
</li>
<li>We allow nested packages<ul>
<li>TODO(gp): Clarify the rules here</li>
</ul>
</li>
<li>We don't want to abuse packaging by creating too many of them<ul>
<li>Rationale:</li>
<li>There is overhead in organizing and maintaining code in packages and we
    want to pay the overhead only if we get enough benefit from this</li>
</ul>
</li>
<li>
<p>We specify a short import in the <code>__init__.py</code> file for a package manually
    because the linter cannot do it automatically yet</p>
<ul>
<li>We use the first letters to build a short import and try to keep it less
  than 8 chars long, e.g., <code>im_v2.talos.data.client</code> -&gt; <code>itdcl</code></li>
<li>We insert an import docstring in the <code>__init__.py</code> file manually and then
  we use the specified short import everywhere in the codebase. E.g.,</li>
</ul>
<p>```python
  Import as:</p>
<p>import im_v2.talos.data.client as itdcl
  ```</p>
</li>
</ul>
<h2 id="how-to-import-code-from-unit-tests">How to import code from unit tests</h2>
<ul>
<li>
<p>To avoid churning client code when code is moved among files, we allow unit
  tests to both:</p>
</li>
<li>
<p>Import the package when testing code exported from the package</p>
<ul>
<li>E.g., in <code>market_data/test/market_data_test_case.py</code> you can import the
   package even if it's included
   <code>python
   import market_data as mdata
   … mdata.AbstractMarketData …</code></li>
</ul>
</li>
<li>
<p>Import the files directly with the code and not the package</p>
<ul>
<li>E.g.,
   <code>python
   import market_data.abstract_market_data as mdabmada
   … mdabmada.AbstractMarketData …</code></li>
</ul>
</li>
<li>
<p>To justify, one can argue that unit tests are clients of the code and
       should import packages like any other client</p>
</li>
<li>
<p>To justify, one can interpret that unit tests are tied to specific files,
       so they should be kept in sync with the low-level code and not with the
       public interface. In fact, we already allow unit tests to call private
       functions, acknowledging that unit tests are not regular clients</p>
</li>
<li>
<p>Given that both explanations are valid, we allow both styles</p>
</li>
</ul>
<h3 id="common-unit-test-code">Common unit test code</h3>
<ul>
<li>Unit tests should not import from each other</li>
<li>If there is common code, it should go in libraries inside or outside <code>test</code>
    directories<ul>
<li>E.g., we use <code>foobar_example.py</code> files containing builders for mocks and
    examples of objects to be used by tests</li>
<li>E.g., we use <code>test/foobar_test_case.py</code> or <code>test/foobar_utils.py</code></li>
</ul>
</li>
<li>In other terms, test files are always leaves of the import graph</li>
</ul>
<h1 id="packagelib-hierarchy-and-cycle-prevention">Package/lib hierarchy and cycle prevention</h1>
<ul>
<li>Static import cycles can be detected by the invoke <code>lint_detect_cycles</code></li>
<li>To prevent import cycles, we want to enforce that certain packages don't
  depend on other packages</li>
<li>E.g., <code>helpers</code> should not depend on any other package, besides external
    libraries</li>
<li><code>core</code> should only depend on <code>helpers</code></li>
<li><code>dataflow</code> should only depend on <code>core</code> and <code>helpers</code></li>
<li>These constraints can be expressed in terms of "certain nodes of the import
    graph are sources" or "certain edges in the import graph are forbidden"</li>
<li>We also want to enforce that certain libs don't import others within a single
  package. For example, in <code>helpers</code>, the following hierarchy should be
  respected:</li>
<li><code>hdbg</code> (should not depend on any other helper)</li>
<li><code>hintrospection</code>, <code>hprint</code> (should depend only on hdbg for assertion)</li>
<li><code>henv</code>, <code>hsystem</code>, <code>hio</code>, <code>hversio</code> (this is the base layer to access env
     vars and execute commands)</li>
<li><code>hgit</code> (Git requires accessing env vars and system calls)</li>
<li>A library can only import libs that are "below" it or on the same level<ul>
<li>E.g., <code>henv</code> can import <code>hdbg</code>, <code>hprint</code>, and <code>hio</code>, but it cannot import <code>hgit</code></li>
<li>While importing a lib on the same level, make sure you are not creating an import cycle</li>
</ul>
</li>
<li>In addition, keep in mind the following rules to prevent import cycles:</li>
<li>Any import inside a function is just a temporary hack waiting to create
    problems</li>
<li>Any time we can break a file into smaller pieces, we should do that since
    this helps control the dependencies</li>
</ul>
<h1 id="anatomy-of-a-package">Anatomy of a package</h1>
<ul>
<li>TODO(gp): Let's use <code>dataflow</code> as a running example</li>
<li>A package has a special <code>__init__.py</code> exporting public methods</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
